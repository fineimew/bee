<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Mauka on Emilia · Open Power Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="**(Now that we have migrated to Docker for deployment, this provides potentially obsolete installation and deployment instructions. Updates soon.)**"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Mauka on Emilia · Open Power Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://openpowerquality.org/index.html"/><meta property="og:description" content="**(Now that we have migrated to Docker for deployment, this provides potentially obsolete installation and deployment instructions. Updates soon.)**"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/opq.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://openpowerquality.org/blog/atom.xml" title="Open Power Quality Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://openpowerquality.org/blog/feed.xml" title="Open Power Quality Blog RSS Feed"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="/js/mathjax-config.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/opqlogo_white.png" alt="Open Power Quality"/><h2 class="headerTitleWithLogo">Open Power Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/intro-motivation.html" target="_self">Documentation</a></li><li class=""><a href="/docs/other-opportunities.html" target="_self">Opportunities</a></li><li class=""><a href="/blog/" target="_self">News</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Mauka on Emilia</h1></header><article><div><span><p><strong>(Now that we have migrated to Docker for deployment, this provides potentially obsolete installation and deployment instructions. Updates soon.)</strong></p>
<p>There are basically three steps to deploying OPQMauka on emilia: building the production bundle (a Python application) on a development machine, installing OPQ Mauka on the production machine, and managing the OPQMauka service.</p>
<h2><a class="anchor" aria-hidden="true" id="build-and-deploy-the-production-bundle"></a><a href="#build-and-deploy-the-production-bundle" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build and deploy the production bundle</h2>
<p>In general, you will build the production bundle from the master branch of OPQ Mauka.</p>
<p>First, make sure you have <a href="emilia-ssh.html">set up opquser ssh access</a>.</p>
<p>In your development environment, be sure you are in the master branch, then change directories into the <code>opq/mauka/deploy/</code> directory.</p>
<p>This directory contains the following items:</p>
<ul>
<li>deploy-build.sh: Builds OPQ Mauka bundle</li>
<li>deploy-transfer-emilia.sh: Transfers bundle to emilia</li>
<li>deploy-transfer-sim.sh: Transfers bundle to OPQ Sim</li>
<li>deploy-install.sh: Installs the OPQMauka service and utilities on emilia.</li>
<li>mauka-service.sh: Service file that gets installed as system service.</li>
<li>mauka-cli.sh: Utility script for starting the mauka command line interface.</li>
<li>mauka-log.sh: Utility script for viewing mauka log.</li>
<li>[timestamp].tar.bz2 (local copies of created bundles)</li>
</ul>
<p>Now invoke <code>./deploy-build.sh</code>:</p>
<p>This script builds a OPQMauka bundle from the current branch as a compressed tar.bz2 archive.</p>
<p>The following is an example run performed on one of our development machines.</p>
<pre><code class="hljs">$ ./deploy-build.sh
+ cd ../..
++ date +%Y%m%d_%H%M%S
+ TIMESTAMP=<span class="hljs-number">20180515</span>_121432
+ mkdir -p mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432
+ mkdir -p mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432/mauka
+ cp -r mauka<span class="hljs-regexp">/constants mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ cp -r mauka<span class="hljs-regexp">/mongo mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ cp -r mauka<span class="hljs-regexp">/plugins mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ cp -r mauka<span class="hljs-regexp">/protobuf mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ cp mauka<span class="hljs-regexp">/config.json mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ cp mauka<span class="hljs-regexp">/OpqMauka.py mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ cp mauka<span class="hljs-regexp">/requirements.txt mauka/</span>deploy<span class="hljs-regexp">/20180515_121432/</span>mauka
+ mkdir -p mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>mauka-cli.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>mauka-log.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>mauka-service.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>deploy-install.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432
+ tar cvjf mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432.tar.bz2 -C mauka/deploy <span class="hljs-number">20180515</span>_121432
<span class="hljs-number">20180515</span>_121432/
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/scripts/</span>
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/scripts/</span>mauka-cli.sh
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/scripts/</span>mauka-service.sh
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/scripts/</span>mauka-log.sh
<span class="hljs-number">20180515</span>_121432/deploy-install.sh
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>requirements.txt
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>config.json
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>OpqMauka.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/VoltageThresholdPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/base.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/PrintPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/__init__.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/manager.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/broker.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/FrequencyThresholdPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/history.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/IticPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/StatusPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/LocalityPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/AcquisitionTriggerPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/ThdPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/mock.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/MeasurementPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>plugins/ThresholdPlugin.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>mongo/
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>mongo/mongo.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>constants/
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>constants/__init__.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>protobuf/
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>protobuf/opq.proto
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>protobuf/util.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>protobuf/__init__.py
<span class="hljs-number">20180515</span>_121432<span class="hljs-regexp">/mauka/</span>protobuf/opq_pb2.py
+ rm -rf mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180515</span>_121432
+ set +x
</code></pre>
<p>Note that *tar.bz2 files in the deploy directory are gitignored.</p>
<p>Now we can deploy the production bundle either to the production server (emilia) or to a development environment using OPQ Sim. to deploy to the production environment, invoke the deploy-transfer-emilia.sh script passing the bundle as the first and only argument to the script.</p>
<p><code>./deploy-transfer-emilia.sh [bundle]</code></p>
<p>Here is an example of running this step on one of our machines.</p>
<pre><code class="hljs">./deploy-transfer-emilia<span class="hljs-selector-class">.sh</span> <span class="hljs-number">20180515</span>_121432<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span>
+ DIST=<span class="hljs-number">20180515</span>_121432<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span>
+ scp -P <span class="hljs-number">29862</span> <span class="hljs-number">20180515</span>_121432<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span> opquser@emilia<span class="hljs-selector-class">.ics</span><span class="hljs-selector-class">.hawaii</span><span class="hljs-selector-class">.edu</span>:/home/opquser/mauka/.
<span class="hljs-number">20180515</span>_121432<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span>  <span class="hljs-number">100%</span>   <span class="hljs-number">21</span>KB <span class="hljs-number">648.7</span>KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>
+ set +x
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="server-side-deployment-tasks"></a><a href="#server-side-deployment-tasks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server-side deployment tasks</h2>
<p>Now ssh into the server to do the remainder of the deployment.</p>
<p>If you are deploying to production (emilia), use the following command:</p>
<pre><code class="hljs">ssh -<span class="hljs-selector-tag">p</span> <span class="hljs-number">29862</span> opquser@emilia<span class="hljs-selector-class">.ics</span><span class="hljs-selector-class">.hawaii</span><span class="hljs-selector-class">.edu</span>
</code></pre>
<p>If you are deploying to the development environment (OPQ Sim), use the following command:</p>
<pre><code class="hljs">ssh -p <span class="hljs-number">3022</span> <span class="hljs-symbol">pi@</span>localhost
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="unpack-tar-file-with-latest-release"></a><a href="#unpack-tar-file-with-latest-release" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unpack tar file with latest release</h3>
<p>Change directories into the mauka/ subdirectory, and list the files:</p>
<pre><code class="hljs"><span class="hljs-symbol">opquser@</span>emilia:~/mauka$ ls -al
total <span class="hljs-number">108</span>
drwxr-xr-x  <span class="hljs-number">4</span> opquser opquser  <span class="hljs-number">4096</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">19</span> .
drwxr-xr-x <span class="hljs-number">12</span> opquser opquser  <span class="hljs-number">4096</span> May  <span class="hljs-number">9</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span> ..
drwxr-xr-x  <span class="hljs-number">4</span> opquser opquser  <span class="hljs-number">4096</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span>:<span class="hljs-number">11</span> <span class="hljs-number">20180410</span>_131135
-rwxr-xr-x  <span class="hljs-number">1</span> opquser opquser <span class="hljs-number">22143</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span>:<span class="hljs-number">11</span> <span class="hljs-number">20180410</span>_131135.tar.bz2
drwxr-xr-x  <span class="hljs-number">4</span> opquser opquser  <span class="hljs-number">4096</span> May  <span class="hljs-number">9</span> <span class="hljs-number">13</span>:<span class="hljs-number">00</span> <span class="hljs-number">20180509</span>_130012
-rw-r--r--  <span class="hljs-number">1</span> opquser opquser <span class="hljs-number">43095</span> May  <span class="hljs-number">9</span> <span class="hljs-number">13</span>:<span class="hljs-number">00</span> <span class="hljs-number">20180509</span>_130012.tar.bz2
-rw-r--r--  <span class="hljs-number">1</span> opquser opquser <span class="hljs-number">21705</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">19</span> <span class="hljs-number">20180515</span>_121432.tar.bz2

</code></pre>
<p>You should see one (or more) timestamped tar.bz2 files (and potentially directories). The most recent timestamped tar.bz2 file is the one you just copied over.  Expand it into a directory as follows:</p>
<pre><code class="hljs">$ tar xfv <span class="hljs-number">20180515</span>_121432<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span>
</code></pre>
<p>The untar process will look something like</p>
<pre><code class="hljs">opquser@emilia:~/mauka$ tar xfv <span class="hljs-number">20180515</span>_121432<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span>
<span class="hljs-number">20180515</span>_121432/
<span class="hljs-number">20180515</span>_121432/scripts/
<span class="hljs-number">20180515</span>_121432/scripts/mauka-cli<span class="hljs-selector-class">.sh</span>
<span class="hljs-number">20180515</span>_121432/scripts/mauka-service<span class="hljs-selector-class">.sh</span>
<span class="hljs-number">20180515</span>_121432/scripts/mauka-log<span class="hljs-selector-class">.sh</span>
<span class="hljs-number">20180515</span>_121432/deploy-install<span class="hljs-selector-class">.sh</span>
<span class="hljs-number">20180515</span>_121432/mauka/
<span class="hljs-number">20180515</span>_121432/mauka/requirements<span class="hljs-selector-class">.txt</span>
<span class="hljs-number">20180515</span>_121432/mauka/config<span class="hljs-selector-class">.json</span>
<span class="hljs-number">20180515</span>_121432/mauka/OpqMauka<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/
<span class="hljs-number">20180515</span>_121432/mauka/plugins/VoltageThresholdPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/base<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/PrintPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/__init__<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/manager<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/broker<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/FrequencyThresholdPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/history<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/IticPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/StatusPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/LocalityPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/AcquisitionTriggerPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/ThdPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/mock<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/MeasurementPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/plugins/ThresholdPlugin<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/mongo/
<span class="hljs-number">20180515</span>_121432/mauka/mongo/mongo<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/constants/
<span class="hljs-number">20180515</span>_121432/mauka/constants/__init__<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/protobuf/
<span class="hljs-number">20180515</span>_121432/mauka/protobuf/opq<span class="hljs-selector-class">.proto</span>
<span class="hljs-number">20180515</span>_121432/mauka/protobuf/util<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/protobuf/__init__<span class="hljs-selector-class">.py</span>
<span class="hljs-number">20180515</span>_121432/mauka/protobuf/opq_pb2<span class="hljs-selector-class">.py</span>
</code></pre>
<p>Then cd into that directory, and list the contents:</p>
<pre><code class="hljs"><span class="hljs-symbol">opquser@</span>emilia:~/mauka$ cd <span class="hljs-number">20180515</span>_121432/
<span class="hljs-symbol">opquser@</span>emilia:~/mauka/<span class="hljs-number">20180515</span>_121432$ ls -al
total <span class="hljs-number">20</span>
drwxr-xr-x <span class="hljs-number">4</span> opquser opquser <span class="hljs-number">4096</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">14</span> .
drwxr-xr-x <span class="hljs-number">5</span> opquser opquser <span class="hljs-number">4096</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">52</span> ..
-rwxr-xr-x <span class="hljs-number">1</span> opquser opquser  <span class="hljs-number">874</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">14</span> deploy-install.sh
drwxr-xr-x <span class="hljs-number">6</span> opquser opquser <span class="hljs-number">4096</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">14</span> mauka
drwxr-xr-x <span class="hljs-number">2</span> opquser opquser <span class="hljs-number">4096</span> May <span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">14</span> scripts
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="prepare-server-side-environment-one-time-setup"></a><a href="#prepare-server-side-environment-one-time-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prepare server-side environment (one time setup)</h3>
<p>These steps will differ depending on the server environment you are working with, therefore they are fairly high-level and you may
have to do additional research for your specific Linux distribution and environement.</p>
<ol>
<li>Ensure that Python 3.6 or greater is installed.</li>
<li>Ensure that the requirements found in opq/mauka/requirements.txt are installed.</li>
</ol>
<pre><code class="hljs">sudo apt-get <span class="hljs-keyword">install</span> -y python3
pip3 <span class="hljs-keyword">install</span> -r mauka/requirements.txt
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="kill-the-current-opqmauka-process"></a><a href="#kill-the-current-opqmauka-process" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kill the current OPQMauka process</h3>
<p>OPQMauka is installed as a system service which runs under the opq system user account. This is a special account that does not have a login shell which provides hardened security. The other advantage to running as a system service is that the service will automatically boot if the server restarts. Further, the service can be managed by the operating system's <code>service</code> command.</p>
<p>To kill the current OPQMauka service, invoke</p>
<p><code>sudo service mauka stop</code></p>
<h3><a class="anchor" aria-hidden="true" id="install-the-new-version-of-opqmauka"></a><a href="#install-the-new-version-of-opqmauka" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install the new version of OPQMauka</h3>
<p>To install OPQMauka, simple run the <code>deploy-install.sh</code> script as root.</p>
<pre><code class="hljs">opquser@emilia:~/mauka/20180515_121432$ sudo ./deploy-install.<span class="hljs-keyword">sh</span>
+ cp scripts/mauka-service.<span class="hljs-keyword">sh</span> /etc/init.<span class="hljs-keyword">d</span>/mauka
+ <span class="hljs-keyword">update</span>-rc.<span class="hljs-keyword">d</span> mauka defaults
+ cp scripts/mauka-<span class="hljs-keyword">cli</span>.<span class="hljs-keyword">sh</span> /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-keyword">cli</span>
+ chmod +x /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-keyword">cli</span>
+ cp scripts/mauka-<span class="hljs-keyword">log</span>.<span class="hljs-keyword">sh</span> /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-built_in">log</span>
+ chmod +x /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-built_in">log</span>
+ <span class="hljs-keyword">mkdir</span> -p /usr/<span class="hljs-keyword">local</span>/bin/opq
+ chown -R opq:opq /usr/<span class="hljs-keyword">local</span>/bin/opq
+ cp -R mauka /usr/<span class="hljs-keyword">local</span>/bin/opq/.
+ cp mauka/config.json /etc/opq/mauka/config.json
+ <span class="hljs-keyword">mkdir</span> -p /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/opq
+ chown -R opq:opq /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/opq
+ <span class="hljs-keyword">set</span> +o xtrace
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="run-the-new-version-of-opqmauka"></a><a href="#run-the-new-version-of-opqmauka" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run the new version of OPQMauka</h3>
<p>To run the new version of OPQMauka, start the service with</p>
<p><code>sudo service mauka start</code></p>
<p>The service will run as a daemon process with all log information going to <code>/var/log/opq/mauka.log</code>. This file can be tailed and monitored in real time by running the shortcut <code>mauka-log</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="verify-that-the-new-opqmauka-is-running"></a><a href="#verify-that-the-new-opqmauka-is-running" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify that the new OPQMauka is running</h2>
<h3><a class="anchor" aria-hidden="true" id="check-the-process-list"></a><a href="#check-the-process-list" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Check the process list</h3>
<p>Check the process list with <code>ps aux | grep Mauka</code> and you should see a process for each plugin running under the user <code>opq</code></p>
<pre><code class="hljs"><span class="hljs-symbol">opquser@</span>emilia:~$ ps aux | grep Mauka
opq      <span class="hljs-number">14403</span> <span class="hljs-number">10.3</span>  <span class="hljs-number">0.5</span> <span class="hljs-number">339040</span> <span class="hljs-number">45704</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">41</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14417</span>  <span class="hljs-number">0.2</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">256992</span> <span class="hljs-number">37744</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14418</span>  <span class="hljs-number">0.2</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">257128</span> <span class="hljs-number">36880</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">01</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14421</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552088</span> <span class="hljs-number">38660</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14424</span>  <span class="hljs-number">0.3</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552108</span> <span class="hljs-number">38804</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">01</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14425</span>  <span class="hljs-number">0.3</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552116</span> <span class="hljs-number">38812</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">01</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14427</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552140</span> <span class="hljs-number">38660</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14432</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">625888</span> <span class="hljs-number">38832</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opq      <span class="hljs-number">14437</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">634104</span> <span class="hljs-number">38776</span> ?        Sl   <span class="hljs-number">13</span>:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> /usr/bin/python3 /usr/local/bin/opq/mauka/OpqMauka.py /etc/opq/mauka/config.json
opquser  <span class="hljs-number">14836</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">12728</span>  <span class="hljs-number">2220</span> pts/<span class="hljs-number">3</span>    S+   <span class="hljs-number">13</span>:<span class="hljs-number">30</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> grep Mauka
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="check-plugin-status-with-mauka-cli"></a><a href="#check-plugin-status-with-mauka-cli" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Check plugin status with mauka-cli</h3>
<p>Start the mauka command line interface <code>mauka-cli</code></p>
<pre><code class="hljs">opquser@emilia:~$ mauka-cli
[<span class="hljs-string">INFO</span>][<span class="hljs-symbol">2018-04-10 13:32:36,814</span>][<span class="hljs-string">14947 manager.py:565 - &lt;module&gt;() </span>] Starting OpqMauka CLI
[<span class="hljs-string">INFO</span>][<span class="hljs-symbol">2018-04-10 13:32:36,814</span>][<span class="hljs-string">14947 manager.py:553 - load_config() </span>] Loading configuration from /etc/opq/mauka/config.json
</code></pre>
<p>To check the status of the plugins, provide the command <code>list-plugins</code></p>
<pre><code class="hljs">opq-mauka&gt; list-plugins
[DEBUG][<span class="hljs-number">2018</span><span class="hljs-number">-04</span><span class="hljs-number">-10</span> <span class="hljs-number">13</span>:<span class="hljs-number">33</span>:<span class="hljs-number">24</span>,<span class="hljs-number">780</span>][<span class="hljs-number">14947</span> manager.<span class="hljs-string">py:</span><span class="hljs-number">541</span> - run_cli() ] <span class="hljs-string">name:</span>AcquisitionTriggerPlugin       <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-8</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14437</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>FrequencyThresholdPlugin       <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-4</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14424</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>IticPlugin                     <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-3</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14421</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>StatusPlugin                   <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-7</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14432</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>ThdPlugin                      <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-6</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14427</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>VoltageThresholdPlugin         <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-5</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14425</span> <span class="hljs-string">exit_event:</span>False
</code></pre>
<p>Here, we see that the plugins are enabled, started, and not set to exit which shows they are are in working order.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#build-and-deploy-the-production-bundle">Build and deploy the production bundle</a></li><li><a href="#server-side-deployment-tasks">Server-side deployment tasks</a><ul class="toc-headings"><li><a href="#unpack-tar-file-with-latest-release">Unpack tar file with latest release</a></li><li><a href="#prepare-server-side-environment-one-time-setup">Prepare server-side environment (one time setup)</a></li><li><a href="#kill-the-current-opqmauka-process">Kill the current OPQMauka process</a></li><li><a href="#install-the-new-version-of-opqmauka">Install the new version of OPQMauka</a></li><li><a href="#run-the-new-version-of-opqmauka">Run the new version of OPQMauka</a></li></ul></li><li><a href="#verify-that-the-new-opqmauka-is-running">Verify that the new OPQMauka is running</a><ul class="toc-headings"><li><a href="#check-the-process-list">Check the process list</a></li><li><a href="#check-plugin-status-with-mauka-cli">Check plugin status with mauka-cli</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/opqlogo_white.png" alt="Open Power Quality" width="66" height="58"/></a><div><h5>Documentation Quick Links</h5><a href="/docs/intro-opq.html">Overview</a><a href="/docs/userguide-hardware.html">OPQ Box User Guide</a><a href="/docs/userguide-software.html">OPQ View User Guide</a><a href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a><a href="/docs/other-roadmap.html">Roadmap</a></div><div><h5>Community</h5><a href="https://openpowerquality.slack.com/" target="_blank" rel="noreferrer noopener">Slack</a><a href="https://twitter.com/opquality" target="_blank" rel="noreferrer noopener">Twitter</a><a href="/blog">News</a><a href="https://ics02.colo.hawaii.edu/">Public OPQ Cloud</a><a href="/contact-us.html">Contact Us</a></div><div><h5>Development</h5><a href="https://github.com/openpowerquality">GitHub</a><a href="https://github.com/openpowerquality/opq/projects">Project Boards</a><a href="/team.html">Developer Team</a><a href="/docs/opportunities.html">Opportunities</a></div></section><p style="text-align:center;color:#e9faff">Open Power Quality is sponsored by:<br/><a style="text-align:center;color:#e9faff" href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://ee.hawaii.edu">Department of Electrical Engineering, University of Hawaii</a><br/></p></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '9bf16cc78135dbeeb3826894ebbbb2ee',
                indexName: 'openpowerquality',
                inputSelector: '#search_input_react'
              });
            </script></body></html>